# ──────────────────────────────────────────────────────────────────────────────
#  Dockerfile – ROS 2 Jazzy 用 DevContainer（日本語ロケール対応）
# ──────────────────────────────────────────────────────────────────────────────
#  * ベース       : GUI 付き osrf/ros:jazzy-desktop
#  * 追加パッケージ: image_transport / ros2_control / demo_nodes_cpp ほか
#  * ワークスペース: /workspaces/ros_ws/src
#  * ROS 環境     : すべてのシェルで自動 source
# ──────────────────────────────────────────────────────────────────────────────
# 2025-06-12 作成
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------  
# ベースイメージ
# -----------------------------------------------------------------------------
# * osrf/ros:jazzy-desktop には  
#   - Ubuntu 22.04 (Jammy)  
#   - ROS 2 Jazzy “desktop” バリアント（GUI & デモ込み）  
#   があらかじめ入っています
# -----------------------------------------------------------------------------



# -----------------------------------------------------------------------------  
# 追加で必要な ROS パッケージ／開発ツール
# -----------------------------------------------------------------------------
FROM osrf/ros:jazzy-desktop

# ★ どの RUN よりも前で宣言（buildkit ラッパーでも引き継がれる）
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    build-essential \
    python3-pip \
    ros-jazzy-image-transport \
    ros-jazzy-ros2-control \
    ros-jazzy-demo-nodes-cpp && \
    # キャッシュ削減
    rm -rf /var/lib/apt/lists/*


# -----------------------------------------------------------------------------  
# ワークスペース作成
# -----------------------------------------------------------------------------
WORKDIR /workspaces/ros_ws
RUN mkdir -p src

# -----------------------------------------------------------------------------  
# すべてのシェルで ROS 環境を自動読み込み
# -----------------------------------------------------------------------------
ENV BASH_ENV=/opt/ros/jazzy/setup.bash
RUN echo "source /opt/ros/jazzy/setup.bash" >> /etc/bash.bashrc

# -----------------------------------------------------------------------------  
# デフォルトコマンド（ログインシェル）
# -----------------------------------------------------------------------------
CMD ["bash", "-l"]